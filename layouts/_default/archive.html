{{ define "main" }}
<div class="main-container fund-padding-top">
    <div class="left-container fund-border" style="min-height: 84vh">
        <div id="about-title" class="title-container fund-title">
            {{- $tagTitle := .Site.Params.tagsTitle | default .Title -}}
            {{ .Title }}
        </div>

        {{/* 获取文章并按年份分组 */}}
        {{ $posts := where .Site.RegularPages "Type" "posts" }}
        {{ $grouped := $posts.GroupByDate "2006" }}

        {{/* ---------- 年份切换按钮 ---------- */}}
        <div class="tabs">
            <div class="button-group">
                {{ range $index, $group := $grouped }}
                <button class="tab-item {{ if eq $index 0 }}active{{ end }}"
                        tab-id="year-{{ $group.Key }}">
                    {{ $group.Key }}（{{ len $group.Pages }}）
                </button>
                {{ end }}
            </div>
        </div>

        {{/* ---------- 时间轴内容区域 ---------- */}}
        <div class="tab-container">
            {{ range $index, $group := $grouped }}
            <div id="year-{{ $group.Key }}" class="tab-pane {{ if eq $index 0 }}active{{ end }}">

                <div class="timeline-wrapper">
                    <ul class="timeline">
                        {{/* 正确写法：使用 $group.Pages */}}
                        {{ range $group.Pages }}
                        <li>
                            <div class="timeline-item">
                                <span class="timeline-item-date">{{ .Date.Format "01-02" }}</span>
                                <div class="timeline-item-body">
                                    <div class="timeline-item-title">
                                        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                                    </div>
                                    <div class="timeline-item-meta">
                                        {{/* 作者与最后更新时间 */}}
                                        {{/* ---------- 作者 ---------- */}}
                                        <div class="timeline-meta-author">
                                            <span class="author">由
                                                <strong>
                                                    {{ range $i, $a := .Params.author }}
                                                    {{ if gt $i 0 }}, {{ end }}{{ $a }}
                                                    {{ end }}
                                                </strong>
                                            </span>
                                            {{ $last := or .Params.lastmod .Lastmod }}
                                            <span class="time">最后更新于 <strong>{{ $last.Format "2006-01-02" }}</strong></span>
                                        </div>
                                        {{/* Tags */}}
                                        <div class = "timeline-tags shadow-a">
                                            {{ range .Params.tags }}
                                            <a class="post-tag">
                                                <span>#</span>
                                                <span>{{.}}</span>
                                            </a>
                                            {{- end }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </li>
                        {{ end }}
                    </ul>
                </div>

            </div>
            {{ end }}
        </div>

    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.addEventListener('click', function() {
                const tabId = this.getAttribute('tab-id');
                document.querySelectorAll('.tab-item').forEach(item => item.classList.remove('active'));
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                this.classList.add('active');
                document.querySelector(`#${tabId}`).classList.add('active');
            });
        });
    });
</script>

{{ end }}
